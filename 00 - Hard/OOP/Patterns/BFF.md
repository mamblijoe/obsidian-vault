### **Презентация-доклад: BFF (Backend for Frontend)**

---

## 1. **ПАТТЕРН BFF**


## 2. **BACKEND FOR FRONTEND A.K.A BEST FRIENDS FOREVER**

Современное веб-приложение состоит из интерфейса, с которым работает пользователь, и бэкенда, который пользователь не видит. Бэкенд может быть устроен по-разному, всё зависит от задачи. Бэкенд крупных веб-приложений обычно довольно сложно устроен.

Как правило, бэкенд — это совокупность разных программ (микросервисы) или одна большая программа (монолит). В современном вебе всё чаще используется микросервисный подход. Проблема такого сложного бэкенда состоит в том, что каждый микросервис предоставляет уникальный [программный интерфейс](https://doka.guide/tools/api/). Фронтенду приходится работать с каждым микросервисом отдельно и помнить API каждого. Это неудобно, создаёт жёсткую связь между фронтендом и бэкендом, требует много знаний о внутреннем устройстве бэкенда. Решение этой проблемы состоит в том, чтобы сделать один унифицированный интерфейс, который в свою очередь будет обращаться ко всем микросервисам.

## 3. **API GATEWAY КАК НАЧАЛО**

Одним из первых таких решений был Gateway, который является, как правило, прокси-сервером и предоставляет единое окно для доступа к данным по определённому программному интерфейсу (Application Programmable Interface — API), пересылая данные от фронтенда к нужному микросервису и обратно. Внешний вид приложения пользователя меняется, бизнес-логика меняется, клиентское приложение меняется, может меняться и контракт, но на остальные API это никак не влияет. Gateway пересылает запросы со стороны клиентов на другие API, учитывая разницу в контрактах, и этим позволяет снизить зацепление бэкенда и фронтенда в веб-приложении. Как правило, на стороне Gateway частые запросы могут кэшироваться, может быть реализована простая бизнес-логика, которая обеспечивает контроль над набором пересылаемых данных между клиентом и внешним API.

## 4. **API GATEWAY**

API Gateway— это сервер, который действует как единая точка входа для клиентов для доступа к нескольким серверным службам. Он централизует управление запросами, маршрутизацию и различные сквозные задачи, такие как аутентификация и ведение журнала.

Характеристики API Gateway:

- Маршрутизация запросов: направляет входящие запросы в соответствующие микросервисы на основе URL-адреса запроса и параметров.
- Аутентификация и безопасность. Применяет меры безопасности, такие как ключи API или токены OAuth, для защиты серверных служб.
- Балансировка нагрузки: распределяет входящие запросы между несколькими экземплярами служб для оптимизации производительности и обеспечения высокой доступности.
- Трансляция протокола: преобразует запросы из одного протокола (например, HTTP) в другой (например, WebSocket) для облегчения связи между клиентами и службами.
- Ограничение скорости: контролирует количество запросов, которые клиент может сделать в течение определенного периода времени, чтобы предотвратить злоупотребления и обеспечить справедливое распределение ресурсов.

## 5. **КОГДА ИСПОЛЬЗОВАТЬ API GATEWAY**

- Управление микросервисами: API Gateway может упростить архитектуру, предоставляя единую точку входа для различных микросервисов, упрощая управление и защиту сложных систем.
- Управление безопасностью: организации могут реализовать аутентификацию и авторизацию на уровне API Gateway, гарантируя, что только законные запросы достигают внутренних служб.
- Аналитика и мониторинг: API Gateway может собирать метрики и журналы для входящих запросов, предоставляя информацию о шаблонах использования и потенциальных проблемах.
- Ограничение скорости и квоты: для управления потреблением API шлюз может применять ограничения скорости и квоты, предотвращая злоупотребления и обеспечивая доступность услуг для всех пользователей.
  
## 6. **ОТ API GATEWAY К BFF**

Работа Backend-for-Frontend, который является развитием идеи единого окна, похожа на Gateway в задачах обеспечения единого контракта и контроля над набором данных. BFF обязательно включает в себя Gateway, к которому предъявляются следующие требования:

- Общие шаблоны на клиенте и сервере (например, [JSX](https://ru.reactjs.org/docs/introducing-jsx.html)).
- Высокая скорость ответа под нагрузкой.
* Единый язык на клиенте и промежуточном сервере BFF. 

## 7. ** ХАРАКТЕРИСТИКИ BFF**

Шаблон Backend For Frontend (BFF) подразумевает создание выделенных бэкенд-сервисов, адаптированных для определенных фронтенд-приложений. Каждый BFF служит посредником между фронтендом и различными бэкенд-сервисами, оптимизируя коммуникацию и извлечение данных.

Характеристики BFF:

- API-интерфейсы, специфичные для клиента: каждый BFF разработан для удовлетворения уникальных потребностей соответствующего ему фронтенд-приложения, что позволяет сократить ненужную передачу данных и повысить производительность.
- Оптимизированная обработка данных: BFF объединяет данные из нескольких внутренних служб, минимизируя количество запросов, сделанных клиентом, что сокращает время отклика.
- Простота разработки: команды фронтенд-разработчиков могут разрабатывать и итерировать свои BFF независимо, что снижает зависимость от изменений во внутренних службах.
- Гибкость: BFF могут развиваться вместе со своими соответствующими фронтенд-приложениями, что позволяет выполнять быстрые циклы разработки и индивидуальные обновления.

## 8. **Основные концепции BFF**

- Разделение backend-логики между универсальным API и специфичным для клиента backend
- Различие между традиционной архитектурой API и BFF
- Взаимодействие BFF с различными клиентами (Web, Mobile, IoT)

## 9. **КОГДА ИСПОЛЬЗОВАТЬ BFF**

- Мобильные приложения: BFF может адаптировать ответы специально для мобильных клиентов, оптимизируя полезные данные для минимизации задержек и улучшения пользовательского опыта.
- Одностраничные приложения (SPA): Различные SPA могут иметь свои собственные BFF, что позволяет использовать настраиваемые API, соответствующие их конкретным потребностям, что приводит к повышению производительности и эффективности.
- Множественные типы клиентов: Организации, обслуживающие разные типы клиентов (например, веб, мобильные, IoT), могут создавать несколько BFF, каждый из которых предназначен для удовлетворения уникальных требований своих клиентов.
- Быстрое прототипирование: BFF позволяют командам frontend быстро итерировать и тестировать новые функции, не влияя на backend, ускоряя процесс разработки.  

## 10. **ПРЕИМУЩЕСТВА**

- Оптимизация работы с API для конкретного клиента
- Повышение производительности
- Гибкость и независимость frontend-команд
- Улучшенная безопасность
- Возможность кэширования и предобработки данных на стороне BFF
- Фильтрация. Клиент получает только то, что ему нужно, ни больше ни меньше.
- Агрегация. Не нужно тратить клиентскую сеть и батарею, чтобы делать множественные аякс-запросы. Заметный выигрыш по скорости за счет того, что открытие соединения — это дорогая операция.
- Кэширование. Ваш повторный агрегированный вызов не будет лишний раз никого дергать, а просто вернет 304 Not Modified.
- Сокрытие данных. Например, у вас могут быть токены, которые нужны между бэкендами и не должны попадать на клиент. У клиента может не быть прав даже знать о существовании этих токенов, не говоря уже об их содержимом.
- Микросервисы. Если у вас на бэке монолит, то BFF — это первый шаг к микросервисам

## 11. **ИЗДЕРЖКИ**

- Усложнение инфраструктуры
- Поддержка и масштабирование BFF
- Дублирование логики между разными BFF
- Дополнительные затраты на разработку и поддержку
- Повышение сложности. Любая абстракция — это еще один слой, который необходимо кодить, деплоить, поддерживать. Еще одна движущаяся часть механизма, которая может сбоить.
- Дублирование ручек. Например, несколько ендпойнтов могут выполнять один и тот же тип агрегаций.
- BFF — это пограничный слой, который должен поддерживать общую маршрутизацию, ограничения прав пользователей, ведение журнала запросов и т. д.

## 12. **BFF И МИКРОФРОНТЫ**


## 13. **МИКРОФРОНТЫ БЕЗ BFF**


## 14. **МИКРОФРОНТЫ С BFF**


## 15. **ПРЕИМУЩЕСТВА ИСПОЛЬЗОВАНИЯ**


## 16. **ИТОГИ**