`Fiber` обычный JS объект, который представляет собой единицу работы (`unit of work`) который обрабатывается функциями `beginWork()` и `completeWork()`.

### Работа / unit of work
Работа это:
* изменение стейта
* функция жизненного цикла
* изменения в `DOM`

Работа может быть обработана сейчас или запланирована на будущее

Работу можно поделить на чанки с помощью `time slicing`

Высоко приоритетная работа может быть запланирована и выполнена ASAP. Используется `requestAnimationFrame()`

Низкоприоритетная работа может быть выполнена с задержкой. Используется `requestIdleCallback()`
### Fiber
`React` взаимодействует с `Fiber`, мы получаем "выполненную работу" и эта работа далее коммитися в виде визуальных изменений в `DOM`

`Fiber reconciler` - `reconciler` основанный на `fiber` (дефолтный `reconciler` c 16 версии `React`)

`Fiber` фокусируется на `анимациях` и `отзывчивости`
 
 `Fiber` может делить работу на чанки и назначать приоритеты, ставить на паузу работу и вернуться к ним позже, переиспользовать уже выполненную работу или отменить работу
 
 `Fiber` асинхронный
 
 `Fiber` создаются из `React` элементов. `createFiberFormElement()`, `createFiberFromFragment()` и т.д.
 
 Большинство `Fiber` создает в время `initial mount`, а потом переиспользуются
 
 Представляет собой форму дерева
 
 `Fiber` делает React быстрее и умнее

### Свойства `Fiber`
`stateNode` свойство содержит ссылку на `Fiber` и через него можно получить доступ к стейту `Fiber`

`tag`. `Fiber` всегда находится в отношения 1 - 1 с чем то (инстансы компонентов, `DOM` нода и тд). Тип с чем есть отношение содержится в свойстве `tag`
>[!tip] tag
>Принимает числовое значение от 0 до 24
>Например:
>```js
>export const FunctionComponent = 0;
>```

`child` - ссылка на первого ребенка, то что возвращается после вызова `render()` компонента

`sibling` - сосед `child` или другого `sibling`, не является `child` или `return`. Так же кейс когда возвращается несколько элементов в массиве
`return` - ссылка на родителя

`alternate` - указывает на другой `Fiber` в паре. Помогает в переиспользовании. 
>[!tip]
>В любой момент времени экземпляр компонента имеет не более двух соответствующих ему `Fiber`: текущий `Fiber` и `in-progress Fiber`. Заместителем текущего `Fiber` является `in-progress Fiber`, а заместителем выполняемого `in-progress Fiber` - текущий `Fiber`.  Текущий `Fiber` представляет то, что уже отрисовано, а `in-progress Fiber` концептуально является фреймом стека, который еще не вернулся

`type` - хост компонент или функция для композиции компонентов

`key` - обычный `React key`

`pendingProps` представляет пропсы, переданные компоненту

`memoizedProps` инициализируется в конце стека выполнения, сохраняя пропсы этого узла

`pendingWorkPriority` - приоритет
### Fiber tree
Есть 2 дерева: `current` (то что сейчас отображается на экране) и `workInProgress`

Во время фазы Коммита реакт меняет местами деревья

React входит в Fiber вызывая `beginWork()` и продолжает проходится пока не дойдет до Fiber без потомков, затем вызывает `completeWork()`

React сначала заходит в `child`, а потом только если нет `child`, заходит в `sibling`

`beginWork()` вызывается при проходке сверху-вниз, а  `completeWork()` снизу-вверх

Все это выполняется в рекурсивном цикле (`work loop`)

### Кейсы использования
Error Boundaries
Suspense
Concurrent Mode