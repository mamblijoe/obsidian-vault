## Reconciliation

* Все что `React` делает это строит дерево элементов
* Это быстрый процесс, так как `React` элементы обычные `JS` объекты
* Это происходит когда вызывает `render()`
* DOM который содержится в памяти называется `virtual DOM`
* Главная задача - синхронизировать `virtual DOM` с реальным `DOM`
* Во время `initial render` вставляется все дерево целиком
* Когда происходит изменение `React` строит новое дерево
* `React` сравнивает деревья и пытается найти минимальное кол-во операций для синхронизации деревьев, это называет `Diffing algorithm`
* Обычно используется алгоритм `o(n3)`, но `React` использует `Эвристический алгоритм` с сложность `o(n)`

>[!tip] Допущения Diffing algorithm
>* 2 элемента с разным типом дают разные деревья
>* Если есть список элементов которые могут меняться, необходимо задавать `key`
## Rendering

* Рендеринг управляется пакетами-рендерерами (`React DOM`, `React Native`)
* Рендереры управляют процессом `Reconciliation`. Они генерируют дерево элементов и вставляют то что должно быть вставлено
* `React` не знает где он рендерится и каким рендерером
* `React` общается с рендерером, например, для `useState` добавляется в свойство `updater` `ReactDOMUpdater`
```js
const instance = new Component();
instance.props = props;
instance.updater = ReactDOMUpdater;
```

## Fiber

* `Fiber` обычный JS объект, который представляет собой единицу работы (`unit of work`).
>[!tip] Fiber
> `React` взаимодействует с `Fiber`, мы получаем "выполненную работу" и эта работа далее коммитися в виде визуальных изменений в `DOM`
>  `Fiber reconciler` - `reconciler` основанный на `fiber` (дефолтный `reconciler` c 16 версии `React`)
>* `Fiber` фокусируется на `анимациях` и `отзывчивости`
>* `Fiber` может делить работу на чанки и назначать приоритеты, ставить на паузу работу и вернуться к ним позже, переиспользовать уже выполненную работу или отменить работу
>* `Fiber` асинхронный
>* `Fiber` всегда находится в отношения 1 - 1 с чем то (инстансы компонентов, `DOM` нода и тд). Тип с чем есть отношение содержится в свойстве `tag`
>* `stateNode` свойство содержит ссылку на `Fiber` и через него можно получить доступ к стейту `Fiber`
>* `Fiber` делает React быстрее и умнее

>[!tip] tag
>Принимает числовое значение от 0 до 24
>Например:
>```js
>export const FunctionComponent = 0;
>```

* Старый reconciler  - стековый и синхронный, должен разгребать все из стека пока тот не опустеет и не может быть прерван
* Процесс происходит в 2 фазы:
	* Фаза рендера
	* Фаза коммита
>[!tip] Фаза рендера
>Эта фаза асинхронная и может быть прервана
>Задачи здесь могут получать приоритет, работ может быть поставлена на паузу, отменена или тд
>React работает с Fiber
>Вызываются `beginWork()` и `completeWork()`

>[!tip] Фаза коммита
>Эта фаза синхронная и не может быть прервана
>Вызывается `commitWork()`


